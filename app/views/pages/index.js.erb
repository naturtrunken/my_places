// Variables for the map
var map;
var marker = [];
var marker_count = 0;

$(document).on('pagecreate', '#index', function (e) {

    // Load the map
    initmap();

    // Load the markers.
    set_marker();

    // Reload the map tiles after the (jquery mobile) initialisation again.
    setTimeout(function () {
        map.invalidateSize();


    }, 1);

    setTimeout(function () {

        // Add a button
        $('.leaflet-control-zoom').append(
                '<a href="#navigation">N</a>'
        );
    }, 3);

});


// Creates the map.
// ---------------------------------------------------------------------------------------
function initmap() {

    // Create the map
    map = new L.Map('map');

    // Create the OpenStreetMap and Leaflet note.
    var osmUrl = 'http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png';
    var osmAttrib = 'Map data Â© OpenStreetMap contributors';
    var osm = new L.TileLayer(osmUrl, {
        minZoom: 4,
        maxZoom: 19,
        attribution: osmAttrib
    });
    map.addLayer(osm);

    map.setView(new L.LatLng(52.518611, 13.408056), 11);
}


// Create the marker on the map.
// ---------------------------------------------------------------------------------------
function set_marker() {
    <% @places.each do |place| %>

    marker_count++;
    marker[marker_count] = L.marker(
            [<%= place.latitude %>, <%= place.longitude %>],
            { draggable: false }
    );
    marker[marker_count].addTo(map);

    <% end %>
}
